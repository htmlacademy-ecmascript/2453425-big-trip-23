(()=>{"use strict";const e="afterbegin",t=(e,t,n="beforeend")=>{t.insertAdjacentElement(n,e.element)},n=(e,t)=>{if(!(e instanceof s&&t instanceof s))throw new Error("Can replace only components");const n=e.element,i=t.element,o=i.parentElement;if(!o)throw new Error("Parent element doesn't exist");o.replaceChild(n,i)},i=e=>{if(e){if(!(e instanceof s))throw new Error("Can remove only component");e.element.remove(),e.removeElement()}};class s{#e=null;constructor(){if(new.target===s)throw new Error("Can't instantiate Abstract, only concrete one.")}get element(){return this.#e||(this.#e=(e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild})(this.template)),this.#e}get template(){throw new Error("Abstract method not implemented: get template")}removeElement(){this.#e=null}}class o extends s{#t=null;#n=null;#i=null;#s=null;constructor({sortTypes:e,sortItems:t,currentSort:n,onSortChange:i}){super(),this.#t=e,this.#i=t,this.#n=n,this.#s=i,this.element.addEventListener("change",this.#o)}get template(){return e=this.#t,t=this.#i,n=this.#n,`<form class="trip-events__trip-sort  trip-sort" action="#" method="get">\n      ${t.reduce(((t,i)=>`${t} ${((e,t,n)=>`<div class="trip-sort__item  trip-sort__item--${t}">\n    <input\n    id="sort-${t}"\n    class="trip-sort__input visually-hidden"\n    type="radio"\n    name="trip-sort"\n    value="sort-${t}"\n    ${t===n?"checked":""}\n    ${e.includes(t)?"":"disabled"}\n  >\n    <label class="trip-sort__btn" for="sort-${t}">${t}</label>\n  </div>`)(e,i,n)}`),"")}\n    </form>`;var e,t,n}#o=e=>{e.preventDefault();const t=e.target.value.split("-")[1];this.#s(t)}}const a={EVERYTHING:"everything",FUTURE:"future",PRESENT:"present",PAST:"past"},r={DAY:"day",TIME:"time",PRICE:"price"},l={DAY:"day",EVENT:"event",TIME:"time",PRICE:"price",OFFERS:"offers"},d={DAYS:"D",HOURS:"H",MINUTES:"M"},p="PATCH",h="MINOR",c="MAJOR",y="INIT",u="ADD_WAYPOINT",f="DELETE_WAYPOINT",m="UPDATE_WAYPOINT";class v extends s{_state={};updateElement(e){e&&(this._setState(e),this.#a())}_restoreHandlers(){throw new Error("Abstract method not implemented: restoreHandlers")}_setState(e){this._state=structuredClone({...this._state,...e})}#a(){const e=this.element,t=e.parentElement;this.removeElement();const n=this.element;t.replaceChild(n,e),this._restoreHandlers()}}const _={basePrice:0,dateFrom:"",dateTo:"",destination:"",isFavorite:!1,offers:[],type:"flight"};class w extends v{#r=null;#l=null;#d=null;constructor({waypoint:e=_,offers:t,destinations:n,onRollupClick:i,onFormSubmit:s,onFormDeleteClick:o}){super(),this._setState(w.parseWaypointToState(e)),this.waypoint=e,this.offers=t,this.destinations=n,this.#r=i,this.#l=s,this.#d=o,this._restoreHandlers()}get template(){return((e,t,n)=>{const i=t.map((e=>e.type)),s=n.filter((t=>t.id===e.destination))[0],o=n.map((e=>e.name)),a=t.filter((t=>t.type===e.type))[0].offers,r=e.dateFrom.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"2-digit"}).split(",").join(""),l=e.dateTo.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"2-digit"}).split(",").join("");return`<li class="trip-events__item">\n      <form class="event event--edit" action="#" method="post">\n        <header class="event__header">\n          <div class="event__type-wrapper">\n            <label class="event__type  event__type-btn" for="event-type-toggle-1">\n              <span class="visually-hidden">Choose event type</span>\n              <img\n              class="event__type-icon"\n              width="17"\n              height="17"\n              src="img/icons/${e.type}.png" alt="Event type icon"\n              >\n            </label>\n            <input class="event__type-toggle  visually-hidden" id="event-type-toggle-1" type="checkbox">\n\n            <div class="event__type-list">\n              <fieldset class="event__type-group">\n                <legend class="visually-hidden">Event type</legend>\n\n                ${(e=>e.reduce(((e,t)=>`${e} ${(e=>`<div class="event__type-item">\n    <input id="event-type-${e}-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="${e}">\n    <label class="event__type-label  event__type-label--${e}" for="event-type-${e}-1">${e}</label>\n  </div>`)(t)}`),""))(i)}\n\n              </fieldset>\n            </div>\n          </div>\n\n          <div class="event__field-group  event__field-group--destination">\n            <label class="event__label  event__type-output" for="event-destination-1">\n              ${e.type}\n            </label>\n            <input\n            class="event__input\n            event__input--destination"\n            id="event-destination-1"\n            type="text"\n            name="event-destination"\n            value="${s?.name||""}" list="destination-list-1"\n            >\n            ${(e=>`<datalist id="destination-list-1">\n    ${(e=>e.reduce(((e,t)=>`${e} <option value="${t}"></option>`),""))(e)}\n  </datalist>`)(o)}\n          </div>\n\n          <div class="event__field-group  event__field-group--time">\n            <label class="visually-hidden" for="event-start-time-1">From</label>\n            <input class="event__input  event__input--time" id="event-start-time-1" type="text" name="event-start-time" value="${r}">\n            &mdash;\n            <label class="visually-hidden" for="event-end-time-1">To</label>\n            <input class="event__input  event__input--time" id="event-end-time-1" type="text" name="event-end-time" value="${l}">\n          </div>\n\n          <div class="event__field-group  event__field-group--price">\n            <label class="event__label" for="event-price-1">\n              <span class="visually-hidden">Price</span>\n              &euro;\n            </label>\n            <input\n            class="event__input\n            event__input--price"\n            id="event-price-1"\n            type="text"\n            name="event-price"\n            value="${e.basePrice}"\n            >\n          </div>\n\n          <button class="event__save-btn  btn  btn--blue" type="submit">Save</button>\n          <button class="event__reset-btn" type="reset">Delete</button>\n          ${(e=>e.id?'<button class="event__rollup-btn" type="button">\n      <span class="visually-hidden">Open event</span>\n    </button>':"")(e)}\n\n        </header>\n        <section class="event__details">\n          ${((e,t)=>{if(!t.length)return"";const n=t.reduce(((t,n)=>t+((e,t)=>{const n=e.offers.includes(t.id)?"checked":"";return`<div class="event__offer-selector">\n      <input class="event__offer-checkbox  visually-hidden" id="${t.id}" type="checkbox" name="${t.id}" ${n}>\n      <label class="event__offer-label" for="${t.id}">\n        <span class="event__offer-title">${t.title}</span>\n        &plus;&euro;&nbsp;\n        <span class="event__offer-price">${t.price}</span>\n      </label>\n    </div>`})(e,n)),"");return`<section class="event__section  event__section--offers">\n      <h3 class="event__section-title  event__section-title--offers">Offers</h3>\n      <div class="event__available-offers">\n        ${n}\n      </div>\n    </section>`})(e,a)}\n\n          ${d=s,d&&(d.pictures.length||d.description)?`<section class="event__section  event__section--destination">\n      <h3 class="event__section-title  event__section-title--destination">Destination</h3>\n      ${h=d.description,h?`<p class="event__destination-description">${h}</p>`:""}\n      ${p=d.pictures,p.length?`<div class="event__photos-container">\n      <div class="event__photos-tape">\n        ${p.reduce(((e,t)=>`${e} ${(e=>`<img class="event__photo" src="${e.src}" alt="${e.description}">`)(t)}`),"")}\n      </div>\n    </div>`:""}\n    </section>`:""}\n        </section>\n      </form>\n    </li>`;var d,p,h})(this._state,this.offers,this.destinations)}reset(e){this.updateElement(w.parseWaypointToState(e))}_restoreHandlers(){this.element.querySelector("form").addEventListener("submit",this.#p),this.element.querySelector(".event__reset-btn").addEventListener("click",this.#h),this.element.querySelector(".event__type-group").addEventListener("change",this.#c),this.element.querySelector(".event__input--destination").addEventListener("change",this.#y),this.element.querySelector(".event--edit").addEventListener("change",this.#u),this.element.querySelector(".event__input--price").addEventListener("input",this.#f),this.element.querySelector("#event-start-time-1").addEventListener("input",this.#m),this.element.querySelector("#event-end-time-1").addEventListener("input",this.#m),this.#r&&this.element.querySelector(".event__rollup-btn").addEventListener("click",this.#v)}#v=e=>{e.preventDefault(),this.#r()};#c=e=>{e.preventDefault(),this.updateElement({type:e.target.value,offers:[]})};#y=e=>{e.preventDefault();const t=e.target.value,n=this.destinations.filter((e=>e.name===t))[0].id;this.updateElement({destination:n})};#u=e=>{if(e.target.classList.contains("event__offer-checkbox")){e.preventDefault();const t=[...this.element.querySelectorAll(".event__offer-checkbox")].filter((e=>e.checked)).map((e=>e.id));this.updateElement({offers:t})}};#f=e=>{e.preventDefault(),this._setState({basePrice:+e.target.value})};#m=e=>{"event-start-time-1"===e.target.id&&this._setState({dateFrom:new Date(e.target.value)}),"event-end-time-1"===e.target.id&&this._setState({dateTo:new Date(e.target.value)})};#p=e=>{e.preventDefault(),this.#l(w.parseStateToWaypoint(this._state))};#h=e=>{e.preventDefault(),this.#d(w.parseStateToWaypoint(this._state))};static parseWaypointToState(e){const t={...e};return t.isSaving=!1,t.isDisabled=!1,t.isDeleting=!1,t}static parseStateToWaypoint(e){const t={...e};return delete t.isSaving,delete t.isDisabled,delete t.isDeleting,t}}const g={[d.DAYS]:e=>Math.floor(e/864e5),[d.HOURS]:e=>Math.floor(e/36e5%24),[d.MINUTES]:e=>Math.floor(e/6e4%60)},C={[a.EVERYTHING]:e=>e.filter((e=>e)),[a.FUTURE]:e=>e.filter((e=>e.dateFrom>new Date)),[a.PRESENT]:e=>e.filter((e=>e.dateFrom<=new Date&&e.dateTo>=new Date)),[a.PAST]:e=>e.filter((e=>e.dateTo<new Date))},b={[r.DAY]:(e,t)=>e.dateFrom-t.dateFrom,[r.TIME]:(e,t)=>{const n=e.dateTo-e.dateFrom;return t.dateTo-t.dateFrom-n},[r.PRICE]:(e,t)=>t.basePrice-e.basePrice};class E extends s{#_=null;#w=null;#g=null;#r=null;#C=null;constructor({waypoint:e,offers:t,destinations:n,onRollupClick:i,onFavoriteClick:s}){super(),this.#_=e,this.#g=n,this.#w=t,this.#r=i,this.#C=s,this.element.querySelector(".event__rollup-btn").addEventListener("click",this.#v),this.element.querySelector(".event__favorite-btn").addEventListener("click",this.#b)}get template(){return((e,t,n)=>{const i=e.dateFrom.toISOString().slice(0,10),s=e.dateFrom.toISOString().slice(0,16),o=e.dateTo.toISOString().slice(0,16),a=e.dateFrom.toISOString().slice(11,16),r=e.dateTo.toISOString().slice(11,16),l=((e,t)=>{const n=t-e,i=Object.values(d).reduce(((e,t)=>{let i=((e,t)=>{let n=g[t](e);return n=n<1?"":n<10?`0${n}${t}`:`${n}${t}`,n})(n,t);return""===e.trim()||i||(i=`00${t}`),`${e} ${i}`}),"");return i})(e.dateFrom,e.dateTo),p=e.isFavorite?"event__favorite-btn--active":"",h=e.basePrice,c=e.type,y=n.filter((t=>t.id===e.destination))[0].name;return`<li class="trip-events__item">\n      <div class="event">\n        <time class="event__date" datetime="${i}">${e.dateFrom.toLocaleString("en-US",{month:"short",day:"numeric"})}</time>\n        <div class="event__type">\n          <img class="event__type-icon" width="42" height="42" src="img/icons/${c}.png" alt="Event type icon">\n        </div>\n        <h3 class="event__title">${c} ${y}</h3>\n        <div class="event__schedule">\n          <p class="event__time">\n            <time class="event__start-time" datetime="${s}">${a}</time>\n            &mdash;\n            <time class="event__end-time" datetime="${o}">${r}</time>\n          </p>\n          <p class="event__duration">${l}</p>\n        </div>\n        <p class="event__price">\n          &euro;&nbsp;<span class="event__price-value">${h}</span>\n        </p>\n        <h4 class="visually-hidden">Offers:</h4>\n        ${(e=>e.length?`<ul class="event__selected-offers">\n      ${e.reduce(((e,t)=>`${e} ${(({title:e,price:t})=>`<li class="event__offer">\n    <span class="event__offer-title">${e}</span>\n      &plus;&euro;&nbsp;\n    <span class="event__offer-price">${t}</span>\n  </li>`)(t)}`),"")}\n    </ul>`:"")(t.filter((t=>t.type===e.type))[0].offers.filter((t=>e.offers.includes(t.id))))}\n        <button class="event__favorite-btn ${p}" type="button">\n          <span class="visually-hidden">Add to favorite</span>\n          <svg class="event__favorite-icon" width="28" height="28" viewBox="0 0 28 28">\n            <path d="M14 21l-8.22899 4.3262 1.57159-9.1631L.685209 9.67376 9.8855 8.33688 14 0l4.1145 8.33688 9.2003 1.33688-6.6574 6.48934 1.5716 9.1631L14 21z"/>\n          </svg>\n        </button>\n        <button class="event__rollup-btn" type="button">\n          <span class="visually-hidden">Open event</span>\n        </button>\n      </div>\n    </li>`})(this.#_,this.#w,this.#g)}#v=e=>{e.preventDefault(),this.#r()};#b=e=>{e.preventDefault(),this.#C()}}const T="DEFAULT",S="EDITING";class M{#E=null;#T=null;#S=null;#_=null;#w=null;#g=null;#M=null;#D=null;#$=T;constructor({waypointListContainer:e,onDataChange:t,onModeChange:n}){this.#E=e,this.#M=t,this.#D=n}init({waypoint:e,offers:s,destinations:o}){this.#_=e,this.#w=s||this.#w,this.#g=o||this.#g;const a=this.#T,r=this.#S;this.#T=new E({waypoint:this.#_,offers:this.#w,destinations:this.#g,onRollupClick:this.#r,onFavoriteClick:this.#C}),this.#S=new w({waypoint:this.#_,offers:this.#w,destinations:this.#g,onRollupClick:this.#r,onFormSubmit:this.#l,onFormDeleteClick:this.#F}),null!==a||null!==r?(this.#$===T&&n(this.#T,a),this.#$===S&&(n(this.#T,r),this.#$=T),i(a),i(r)):t(this.#T,this.#E)}destroy(){i(this.#T),i(this.#S)}setSaving(){this.#$===S&&this.#S.updateElement({isDisabled:!0,isSaving:!0})}setDeleting(){this.#$===S&&this.#S.updateElement({isDisabled:!0,isDeleting:!0})}resetView(){this.#$!==T&&(this.#S.reset(this.#_),this.#k())}#L=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),this.#S.reset(this.#_),this.#k())};#r=()=>{this.#$!==T?(this.#S.reset(this.#_),this.#k()):this.#I()};#C=()=>{this.#M(m,p,{...this.#_,isFavorite:!this.#_.isFavorite})};#l=e=>{this.#M(m,h,e)};#F=e=>{this.#M(f,h,e)};#I(){n(this.#S,this.#T),document.addEventListener("keydown",this.#L),this.#D(),this.#$=S}#k(){n(this.#T,this.#S),document.removeEventListener("keydown",this.#L),this.#$=T}}class D{#E=null;#S=null;#M=null;#H=null;constructor({waypointListContainer:e,onDataChange:t,onDestroy:n}){this.#E=e,this.#M=t,this.#H=n}init({offers:n,destinations:i}){this.#S||(this.#S=new w({offers:n,destinations:i,isNewWaypoint:!0,onFormSubmit:this.#l,onFormDeleteClick:this.#F}),t(this.#S,this.#E.querySelector(".trip-events__list"),e),document.addEventListener("keydown",this.#L))}destroy(){this.#S&&(this.#H(),i(this.#S),this.#S=null,document.removeEventListener("keydown",this.#L))}setSaving(){this.#S.updeteElement({isDisabled:!0,isSaving:!0})}#l=e=>{this.#M(u,h,e)};#F=()=>{this.destroy()};#L=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),this.destroy())}}class $ extends s{get template(){return'<p class="trip-events__msg">Loading...</p>'}}class F extends s{get template(){return'<ul class="trip-events__list"></ul>'}}const k={[a.EVERYTHING]:"Click New Event to create your first point",[a.FUTURE]:"There are no future events now",[a.PRESENT]:"There are no present events now",[a.PAST]:"There are no past events now"};class L extends s{#x=a.EVERYTHING;setFilterType(e){this.#x=e}get template(){return((e="everything")=>`<p class="trip-events__msg">${k[e]}</p>`)(this.#x)}}class I{#W=new Set;addObserver(e){this.#W.add(e)}removeObserver(e){this.#W.delete(e)}_notify(e,t){this.#W.forEach((n=>n(e,t)))}}class H extends s{#A=null;constructor(e){super(),this.#A=e}get template(){return(e=>{const t=e.map((e=>e.destination)),n=e.map((e=>({dateFrom:e.dateFrom,dateTo:e.dateTo}))),i=e.reduce(((e,t)=>e+t.price),0);return`<section class="trip-main__trip-info  trip-info">\n    <div class="trip-info__main">\n      ${(e=>{let t;return e.length>3&&(t=`${e[0]} &mdash; &hellip; &mdash; ${e[e.length-1]}`),e.length<=3&&(t=e.join(" &mdash; ")),`<h1 class="trip-info__title">${t}</h1>`})(t)}\n\n      ${e.length?(e=>`<p class="trip-info__dates">${e[0].dateFrom.toLocaleString("en-US",{month:"short",day:"numeric"})}&nbsp;&mdash;&nbsp;${e[[e.length-1]].dateTo.toLocaleString("en-US",{month:"short",day:"numeric"})}</p>`)(n):""}\n    </div>\n\n    <p class="trip-info__cost">\n      Total: &euro;&nbsp;<span class="trip-info__cost-value">${i}</span>\n    </p>\n  </section>`})(this.#A)}}class x extends s{#P=null;#R=null;#O=null;constructor({filters:e,currentFilterType:t,onFilterTypeChange:n}){super(),this.#P=e,this.#R=t,this.#O=n,this.element.addEventListener("change",this.#q)}get template(){return((e,t)=>{const n=e.reduce(((e,n)=>`${e} ${((e,t)=>{const{type:n,count:i}=e;return`<div class="trip-filters__filter">\n      <input id="filter-${n}"\n      class="trip-filters__filter-input\n      visually-hidden"\n      type="radio"\n      name="trip-filter"\n      value="${n}"\n      ${n===t?"checked":""}\n      ${0===i?"disabled":""}\n    >\n      <label class="trip-filters__filter-label" for="filter-${n}">${n}</label>\n    </div>`})(n,t)}`),"");return`<form class="trip-filters" action="#" method="get">\n      ${n}\n      <button class="visually-hidden" type="submit">Accept filter</button>\n    </form>`})(this.#P,this.#R)}#q=e=>{e.preventDefault(),this.#O(e.target.value)}}const W=document.querySelector(".trip-events"),A=document.querySelector(".trip-main"),P=document.querySelector(".trip-controls__filters"),R=document.querySelector(".trip-main__event-add-btn"),O=new class extends I{#A=[];#w=[];#g=[];get waypoints(){return this.#A}get offers(){return this.#w}get destinations(){return this.#g}getOffersByType(e){return[...this.#w.find((t=>t.type===e)).offers]}getDestinationById(e){return{...this.#g.find((t=>t.id===e))}}init(){this.#w=[{type:"taxi",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_1",title:"Upgrade to a business class",price:120},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_2",title:"aux",price:50}]},{type:"flight",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_flight_1",title:"Add luggage",price:50},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_flight_2",title:"Switch to comfort",price:80}]},{type:"drive",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_drive_1",title:"Rent a car",price:200}]},{type:"check-in",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_check-in_1",title:"Add breakfast",price:50}]},{type:"sightseeing",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_1",title:"Book tickets",price:40},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_2",title:"Lunch in city",price:30}]}],this.#g=[{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",description:"Chamonix, is a beautiful city, a true asian pearl, with crowded streets.",name:"Chamonix",pictures:[{src:"img/photos/1.jpg",description:"Chamonix parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_2",description:"Amsterdam, is a beautiful city, a true asian pearl, with crowded streets.",name:"Amsterdam",pictures:[{src:"img/photos/2.jpg",description:"Amsterdam parliament building"},{src:"img/photos/3.jpg",description:"Amsterdam parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_3",description:"Geneva, is a beautiful city, a true asian pearl, with crowded streets.",name:"Geneva",pictures:[{src:"img/photos/4.jpg",description:"Geneva parliament building"},{src:"img/photos/5.jpg",description:"Geneva parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_4",description:"Krasnodar, is a beautiful city, a true asian pearl, with crowded streets.",name:"Krasnodar",pictures:[]}],this.#A=[{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_A",base_price:1100,date_from:"2019-07-10T22:55:56.845Z",date_to:"2019-07-11T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",is_favorite:!1,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_1"],type:"taxi"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_B",base_price:500,date_from:"2019-07-12T10:55:56.845Z",date_to:"2019-07-12T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_2",is_favorite:!0,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_flight_1","b4c3e4e6-9053-42ce-b747-e281314baa31_flight_2"],type:"flight"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_C",base_price:2400,date_from:"2019-08-15T22:55:56.845Z",date_to:"2019-08-20T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",is_favorite:!1,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_drive_1"],type:"drive"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_D",base_price:155,date_from:"2019-08-21T08:55:56.845Z",date_to:"2019-08-21T11:00:00.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_4",is_favorite:!0,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_1","b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_2"],type:"sightseeing"}].map(this.#N),this._notify(y)}updateWaypoint(e,t){const n=this.#A.findIndex((e=>e.id===t.id));if(-1===n)throw new Error("Can not update unexisting waypoint");this.#A=[...this.#A.slice(0,n),t,...this.#A.slice(n+1)],this._notify(e,t)}addWaypoint(e,t){t.id=+new Date,this.#A=[...this.#A,t],this._notify(e,t)}deleteWaypoint(e,t){const n=this.#A.findIndex((e=>e.id===t.id));if(-1===n)throw new Error("Can not update unexisting waypoint");this.#A=[...this.#A.slice(0,n),...this.#A.slice(n+1)],this._notify(e,t)}#N=e=>{const t={...e,basePrice:e.base_price,dateFrom:new Date(e.date_from),dateTo:new Date(e.date_to),isFavorite:e.is_favorite};return delete t.base_price,delete t.date_from,delete t.date_to,delete t.is_favorite,t}},q=new class extends I{#Y=a.EVERYTHING;get filter(){return this.#Y}setFilter(e,t){this.#Y=t,this._notify(e,t)}},N=new class extends I{#U=r.DAY;get sort(){return this.#U}setSort(e,t){this.#U=t,this._notify(e,t)}},Y=new class{#j=null;#V=null;#G=null;constructor({tripInfoContainer:e,waypointsModel:t}){this.#G=e,this.#j=t,this.#j.addObserver(this.#K)}init(){const s=this.#j.waypoints.sort(b[r.DAY]).map((e=>{const t=this.#j.getDestinationById(e.destination).name,n=this.#j.getOffersByType(e.type).filter((t=>e.offers.includes(t.id))).reduce(((e,t)=>e+t.price),0);return{dateFrom:e.dateFrom,dateTo:e.dateTo,destination:t,price:e.basePrice+n}})),o=this.#V;this.#V=new H(s),o?(n(this.#V,o),i(o)):t(this.#V,this.#G,e)}#K=()=>{this.init()}}({tripInfoContainer:A,waypointsModel:O}),U=new class{#Z=null;#B=null;#j=null;#z=null;constructor({filterContainer:e,filterModel:t,waypointsModel:n}){this.#Z=e,this.#B=t,this.#j=n,this.#j.addObserver(this.#K),this.#B.addObserver(this.#K)}get filters(){const e=this.#j.waypoints;return Object.values(a).map((t=>({type:t,count:C[t](e).length})))}init(){const e=this.#z;this.#z=new x({filters:this.filters,currentFilterType:this.#B.filter,onFilterTypeChange:this.#O}),e?(n(this.#z,e),i(e)):t(this.#z,this.#Z)}#K=()=>{this.init()};#O=e=>{this.#B.filter!==e&&this.#B.setFilter(c,e)}}({filterContainer:P,filterModel:q,waypointsModel:O}),j=new class{#J=null;#Q=null;#j=null;#X=null;constructor({sortContainer:e,sortModel:t,waypointsModel:n}){this.#J=e,this.#Q=t,this.#j=n,this.#j.addObserver(this.#K),this.#Q.addObserver(this.#K)}get sortTypes(){return Object.values(r).map((e=>e))}get sortItems(){return Object.values(l).map((e=>e))}init(){const s=this.sortTypes,a=this.sortItems,r=this.#X;this.#X=new o({sortTypes:s,sortItems:a,currentSort:this.#Q.sort,onSortChange:this.#s}),r?(n(this.#X,r),i(r)):t(this.#X,this.#J,e)}#s=e=>{this.#Q.sort!==e&&this.#Q.setSort(h,e)};#K=()=>{this.init()}}({sortContainer:W,sortModel:N,waypointsModel:O}),V=new class{#E=null;#j=null;#B=null;#Q=null;#ee=null;#te=new F;#ne=new $;#ie=new L;#x=a.EVERYTHING;#se=r.DAY;#oe=new Map;#ae=!0;constructor({waypointListContainer:e,waypointsModel:t,filterModel:n,sortModel:i,onNewWaypointDestroy:s}){this.#E=e,this.#j=t,this.#B=n,this.#Q=i,this.#ee=new D({waypointListContainer:this.#E,onDataChange:this.#re,onDestroy:s}),this.#j.addObserver(this.#K),this.#B.addObserver(this.#K),this.#Q.addObserver(this.#K)}get waypoints(){this.#x=this.#B.filter,this.#se=this.#Q.sort;const e=this.#j.waypoints;return C[this.#x](e).sort(b[this.#se])}init(){this.#le()}createWaypoint(){const e=this.#j.offers,t=this.#j.destinations;this.#B.setFilter(c,a.EVERYTHING),this.#Q.setSort(c,r.DAY),this.#ee.init({offers:e,destinations:t})}#D=()=>{this.#ee.destroy(),this.#oe.forEach((e=>e.resetView()))};#re=(e,t,n)=>{switch(e){case u:this.#j.addWaypoint(t,n);break;case f:this.#j.deleteWaypoint(t,n);break;case m:this.#oe.get(n.id).setSaving(),this.#j.updateWaypoint(t,n)}};#K=(e,t)=>{switch(e){case p:this.#oe.get(t.id).init(t);break;case h:this.#de(),this.#le();break;case c:this.#de({resetSortType:!0}),this.#le();break;case y:this.#ae=!1,i(this.#ne),this.#le()}};#le(){this.#ae?this.#pe():0!==this.waypoints.length?(t(this.#te,this.#E),this.#he(this.waypoints)):this.#ce()}#de({resetSortType:e=!1}={}){e&&this.#Q.setSort(h,r.DAY),this.#ee.destroy(),this.#oe.forEach((e=>e.destroy())),this.#oe.clear(),this.#ne&&i(this.#ne),this.#ie&&i(this.#ie)}#pe(){t(this.#ne,this.#E)}#ce(){this.#ie.setFilterType(this.#x),t(this.#ie,this.#E)}#he(e){e.forEach((e=>this.#ye(e)))}#ye(e){const t=this.#j.offers,n=this.#j.destinations,i=new M({waypointListContainer:this.#te.element,onDataChange:this.#re,onModeChange:this.#D});i.init({waypoint:e,offers:t,destinations:n}),this.#oe.set(e.id,i)}}({waypointListContainer:W,waypointsModel:O,filterModel:q,sortModel:N,onNewWaypointDestroy:()=>{R.disabled=!1}});V.init(),U.init(),j.init(),Y.init(),O.init(),R.addEventListener("click",(e=>{e.preventDefault(),V.createWaypoint(),R.disabled=!0}))})();
//# sourceMappingURL=bundle.f36df7904f014ab2f4f9.js.map