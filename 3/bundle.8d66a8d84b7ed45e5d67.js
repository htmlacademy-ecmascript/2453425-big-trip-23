(()=>{"use strict";const e=(e,t,n="beforeend")=>{t.insertAdjacentElement(n,e.element)},t=(e,t)=>{if(!(e instanceof i&&t instanceof i))throw new Error("Can replace only components");const n=e.element,s=t.element,o=s.parentElement;if(!o)throw new Error("Parent element doesn't exist");o.replaceChild(n,s)},n=e=>{if(e){if(!(e instanceof i))throw new Error("Can remove only component");e.element.remove(),e.removeElement()}};class i{#e=null;constructor(){if(new.target===i)throw new Error("Can't instantiate Abstract, only concrete one.")}get element(){return this.#e||(this.#e=(e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild})(this.template)),this.#e}get template(){throw new Error("Abstract method not implemented: get template")}removeElement(){this.#e=null}}class s extends i{#t=null;#n=null;#i=null;constructor(e,t,n){super(),this.#t=e,this.#i=t,this.#n=n}get template(){return e=this.#t,t=this.#i,n=this.#n,`<form class="trip-events__trip-sort  trip-sort" action="#" method="get">\n      ${t.reduce(((t,i)=>`${t} ${((e,t,n)=>`<div class="trip-sort__item  trip-sort__item--${t}">\n    <input\n    id="sort-${t}"\n    class="trip-sort__input visually-hidden"\n    type="radio"\n    name="trip-sort"\n    value="sort-${t}"\n    ${t===n?"checked":""}\n    ${e.includes(t)?"":"disabled"}\n  >\n    <label class="trip-sort__btn" for="sort-${t}">${t}</label>\n  </div>`)(e,i,n)}`),"")}\n    </form>`;var e,t,n}}const o={EVERYTHING:"everything",FUTURE:"future",PRESENT:"present",PAST:"past"},a={DAY:"day",TIME:"time",PRICE:"price"},r={DAY:"day",EVENT:"event",TIME:"time",PRICE:"price",OFFERS:"offers"},l={DAYS:"D",HOURS:"H",MINUTES:"M"},c={id:"f4b62099-293f-4c3d-a702-94eec4a2808c_A",base_price:0,date_from:"",date_to:"",destination:"",is_favorite:!1,offers:[],type:"flight"};class p extends i{constructor(e=c,t,n,i,s){super(),this.waypoint=e,this.destination=t,this.offers=n,this.eventTypes=i,this.destinations=s}get template(){return((e,t,n,i,s)=>{const o=e.dateFrom.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"2-digit"}).split(",").join(""),a=e.dateTo.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"2-digit"}).split(",").join("");return`<li class="trip-events__item">\n      <form class="event event--edit" action="#" method="post">\n        <header class="event__header">\n          <div class="event__type-wrapper">\n            <label class="event__type  event__type-btn" for="event-type-toggle-1">\n              <span class="visually-hidden">Choose event type</span>\n              <img class="event__type-icon" width="17" height="17" src="img/icons/${e.type}.png" alt="Event type icon">\n            </label>\n            <input class="event__type-toggle  visually-hidden" id="event-type-toggle-1" type="checkbox">\n\n            <div class="event__type-list">\n              <fieldset class="event__type-group">\n                <legend class="visually-hidden">Event type</legend>\n\n                ${(e=>e.reduce(((e,t)=>`${e} ${(e=>`<div class="event__type-item">\n    <input id="event-type-${e}-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="${e}">\n    <label class="event__type-label  event__type-label--${e}" for="event-type-${e}-1">${e}</label>\n  </div>`)(t)}`),""))(i)}\n\n              </fieldset>\n            </div>\n          </div>\n\n          <div class="event__field-group  event__field-group--destination">\n            <label class="event__label  event__type-output" for="event-destination-1">\n              ${e.type}\n            </label>\n            <input class="event__input  event__input--destination" id="event-destination-1" type="text" name="event-destination" value="${t.name}" list="destination-list-1">\n            ${(e=>`<datalist id="destination-list-1">\n    ${(e=>e.reduce(((e,t)=>`${e} <option value="${t}"></option>`),""))(e)}\n  </datalist>`)(s)}\n          </div>\n\n          <div class="event__field-group  event__field-group--time">\n            <label class="visually-hidden" for="event-start-time-1">From</label>\n            <input class="event__input  event__input--time" id="event-start-time-1" type="text" name="event-start-time" value="${o}">\n            &mdash;\n            <label class="visually-hidden" for="event-end-time-1">To</label>\n            <input class="event__input  event__input--time" id="event-end-time-1" type="text" name="event-end-time" value="${a}">\n          </div>\n\n          <div class="event__field-group  event__field-group--price">\n            <label class="event__label" for="event-price-1">\n              <span class="visually-hidden">Price</span>\n              &euro;\n            </label>\n            <input class="event__input  event__input--price" id="event-price-1" type="text" name="event-price" value="${e.basePrice}">\n          </div>\n\n          <button class="event__save-btn  btn  btn--blue" type="submit">Save</button>\n          <button class="event__reset-btn" type="reset">Delete</button>\n          <button class="event__rollup-btn" type="button">\n            <span class="visually-hidden">Open event</span>\n          </button>\n        </header>\n        <section class="event__details">\n          ${((e,t)=>{if(!t.length)return"";const n=t.reduce(((t,n)=>t+((e,t)=>{const n=e.offers.includes(t.id)?"checked":"";return`<div class="event__offer-selector">\n      <input class="event__offer-checkbox  visually-hidden" id="${t.id}" type="checkbox" name="${t.id}" ${n}>\n      <label class="event__offer-label" for="${t.id}">\n        <span class="event__offer-title">${t.title}</span>\n        &plus;&euro;&nbsp;\n        <span class="event__offer-price">${t.price}</span>\n      </label>\n    </div>`})(e,n)),"");return`<section class="event__section  event__section--offers">\n      <h3 class="event__section-title  event__section-title--offers">Offers</h3>\n      <div class="event__available-offers">\n        ${n}\n      </div>\n    </section>`})(e,n)}\n\n          ${(e=>{return e&&(e.pictures.length||e.description)?`<section class="event__section  event__section--destination">\n      <h3 class="event__section-title  event__section-title--destination">Destination</h3>\n      ${n=e.description,n?`<p class="event__destination-description">${n}</p>`:""}\n      ${t=e.pictures,t.length?`<div class="event__photos-container">\n      <div class="event__photos-tape">\n        ${t.reduce(((e,t)=>`${e} ${(e=>`<img class="event__photo" src="${e.src}" alt="${e.description}">`)(t)}`),"")}\n      </div>\n    </div>`:""}\n    </section>`:"";var t,n})(t)}\n        </section>\n      </form>\n    </li>`})(this.waypoint,this.destination,this.offers,this.eventTypes,this.destinations)}}const d={[l.DAYS]:e=>Math.floor(e/864e5),[l.HOURS]:e=>Math.floor(e/36e5%24),[l.MINUTES]:e=>Math.floor(e/6e4%60)},h={[o.EVERYTHING]:e=>e.filter((e=>e)),[o.FUTURE]:e=>e.filter((e=>e.dateFrom>new Date)),[o.PRESENT]:e=>e.filter((e=>e.dateFrom<=new Date&&e.dateTo>=new Date)),[o.PAST]:e=>e.filter((e=>e.dateTo<=new Date))};class f extends i{#s=null;#o=null;#a=null;constructor(e,t,n){super(),this.#s=e,this.#o=t,this.#a=n}get template(){return((e,t,n)=>{const i=e.dateFrom.toISOString().slice(0,10),s=e.dateFrom.toISOString().slice(0,16),o=e.dateTo.toISOString().slice(0,16),a=e.dateFrom.toISOString().slice(11,16),r=e.dateTo.toISOString().slice(11,16),c=((e,t)=>{const n=t-e,i=Object.values(l).reduce(((e,t)=>{let i=((e,t)=>{let n=d[t](e);return n=n<1?"":n<10?`0${n}${t}`:`${n}${t}`,n})(n,t);return""===e.trim()||i||(i=`00${t}`),`${e} ${i}`}),"");return i})(e.dateFrom,e.dateTo),p=e.isFavorite?"event__favorite-btn--active":"",h=e.basePrice,f=e.type,_=t.name;return`<li class="trip-events__item">\n      <div class="event">\n        <time class="event__date" datetime="${i}">${e.dateFrom.toLocaleString("en-US",{month:"short",day:"numeric"})}</time>\n        <div class="event__type">\n          <img class="event__type-icon" width="42" height="42" src="img/icons/${f}.png" alt="Event type icon">\n        </div>\n        <h3 class="event__title">${f} ${_}</h3>\n        <div class="event__schedule">\n          <p class="event__time">\n            <time class="event__start-time" datetime="${s}">${a}</time>\n            &mdash;\n            <time class="event__end-time" datetime="${o}">${r}</time>\n          </p>\n          <p class="event__duration">${c}</p>\n        </div>\n        <p class="event__price">\n          &euro;&nbsp;<span class="event__price-value">${h}</span>\n        </p>\n        <h4 class="visually-hidden">Offers:</h4>\n        ${(e=>e.length?`<ul class="event__selected-offers">\n      ${e.reduce(((e,t)=>`${e} ${(({title:e,price:t})=>`<li class="event__offer">\n    <span class="event__offer-title">${e}</span>\n      &plus;&euro;&nbsp;\n    <span class="event__offer-price">${t}</span>\n  </li>`)(t)}`),"")}\n    </ul>`:"")(n.filter((t=>e.offers.includes(t.id))))}\n        <button class="event__favorite-btn ${p}" type="button">\n          <span class="visually-hidden">Add to favorite</span>\n          <svg class="event__favorite-icon" width="28" height="28" viewBox="0 0 28 28">\n            <path d="M14 21l-8.22899 4.3262 1.57159-9.1631L.685209 9.67376 9.8855 8.33688 14 0l4.1145 8.33688 9.2003 1.33688-6.6574 6.48934 1.5716 9.1631L14 21z"/>\n          </svg>\n        </button>\n        <button class="event__rollup-btn" type="button">\n          <span class="visually-hidden">Open event</span>\n        </button>\n      </div>\n    </li>`})(this.#s,this.#o,this.#a)}}const _="DEFAULT",u="EDITING";class m{#r=null;#l=null;#c=null;#s=null;#o=null;#a=null;#p=null;#d=null;#h=_;constructor(e){this.#r=e}init(i,s,o,a,r){this.#s=i,this.#o=s,this.#a=o,this.#p=a,this.#d=r;const l=this.#l,c=this.#c;if(this.#l=new f(this.#s,this.#o,this.#a),this.#c=new p(this.#s,this.#o,this.#a,this.#p,this.#d),null===l&&null===c)return e(this.#l,this.#r),void("f4b62099-293f-4c3d-a702-94eec4a2808c_A"===this.#s.id&&this.#f());this.#h===_&&t(this.#l,l),this.#h===u&&(t(this.#l,c),this.#h=_),n(l),n(c)}#f(){t(this.#c,this.#l),this.#h=u}#_(){t(this.#l,this.#c),this.#h=_}}class v extends i{get template(){return'<p class="trip-events__msg">Loading...</p>'}}class y extends i{get template(){return'<ul class="trip-events__list"></ul>'}}const b={[o.EVERYTHING]:"Click New Event to create your first point",[o.FUTURE]:"There are no future events now",[o.PRESENT]:"There are no present events now",[o.PAST]:"There are no past events now"};class g extends i{get template(){return((e="everything")=>`<p class="trip-events__msg">${b[e]}</p>`)()}}class w extends i{constructor(e,t,n){super(),this.destinations=e,this.dates=t,this.cost=n}get template(){return e=this.destinations,t=this.dates,n=this.cost,`<section class="trip-main__trip-info  trip-info">\n    <div class="trip-info__main">\n      ${(e=>{let t;return e.length>3&&(t=`${e[0]} &mdash; &hellip; &mdash; ${e[e.length-1]}`),e.length<=3&&(t=e.join(" &mdash; ")),`<h1 class="trip-info__title">${t}</h1>`})(e)}\n\n      ${e.length?(e=>`<p class="trip-info__dates">${e[0][0].toLocaleString("en-US",{month:"short",day:"numeric"})}&nbsp;&mdash;&nbsp;${e[[e.length-1]][1].toLocaleString("en-US",{month:"short",day:"numeric"})}</p>`)(t):""}\n    </div>\n\n    <p class="trip-info__cost">\n      Total: &euro;&nbsp;<span class="trip-info__cost-value">${n}</span>\n    </p>\n  </section>`;var e,t,n}}class $ extends i{#u=null;#m=null;constructor(e,t){super(),this.#u=e,this.#m=t}get template(){return((e,t)=>{const n=e.reduce(((e,n)=>`${e} ${((e,t)=>{const{type:n,count:i}=e;return`<div class="trip-filters__filter">\n      <input id="filter-${n}"\n      class="trip-filters__filter-input\n      visually-hidden"\n      type="radio"\n      name="trip-filter"\n      value="${n}"\n      ${n===t?"checked":""}\n      ${0===i?"disabled":""}\n    >\n      <label class="trip-filters__filter-label" for="filter-${n}">${n}</label>\n    </div>`})(n,t)}`),"");return`<form class="trip-filters" action="#" method="get">\n      ${n}\n      <button class="visually-hidden" type="submit">Accept filter</button>\n    </form>`})(this.#u,this.#m)}}const C=document.querySelector(".trip-events"),T=document.querySelector(".trip-main"),E=document.querySelector(".trip-controls__filters"),S=new class{#v=[];#a=[];#d=[];get waypoints(){return this.#v}init(){this.#a=[{type:"taxi",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_1",title:"Upgrade to a business class",price:120},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_2",title:"aux",price:50}]},{type:"flight",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_flight_1",title:"Add luggage",price:50},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_flight_2",title:"Switch to comfort",price:80}]},{type:"drive",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_drive_1",title:"Rent a car",price:200}]},{type:"check-in",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_check-in_1",title:"Add breakfast",price:50}]},{type:"sightseeing",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_1",title:"Book tickets",price:40},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_2",title:"Lunch in city",price:30}]}],this.#d=[{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",description:"Chamonix, is a beautiful city, a true asian pearl, with crowded streets.",name:"Chamonix",pictures:[{src:"img/photos/1.jpg",description:"Chamonix parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_2",description:"Amsterdam, is a beautiful city, a true asian pearl, with crowded streets.",name:"Amsterdam",pictures:[{src:"img/photos/2.jpg",description:"Amsterdam parliament building"},{src:"img/photos/3.jpg",description:"Amsterdam parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_3",description:"Geneva, is a beautiful city, a true asian pearl, with crowded streets.",name:"Geneva",pictures:[{src:"img/photos/4.jpg",description:"Geneva parliament building"},{src:"img/photos/5.jpg",description:"Geneva parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_4",description:"Krasnodar, is a beautiful city, a true asian pearl, with crowded streets.",name:"Krasnodar",pictures:[]}],this.#v=[{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_A",base_price:1100,date_from:"2019-07-10T22:55:56.845Z",date_to:"2019-07-11T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",is_favorite:!1,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_1"],type:"taxi"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_B",base_price:500,date_from:"2019-07-12T10:55:56.845Z",date_to:"2019-07-12T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_2",is_favorite:!0,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_flight_1","b4c3e4e6-9053-42ce-b747-e281314baa31_flight_2"],type:"flight"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_C",base_price:2400,date_from:"2019-08-15T22:55:56.845Z",date_to:"2019-08-20T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",is_favorite:!1,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_drive_1"],type:"drive"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_D",base_price:155,date_from:"2019-08-21T08:55:56.845Z",date_to:"2019-08-21T11:00:00.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_4",is_favorite:!0,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_1","b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_2"],type:"sightseeing"}].map(this.#y)}getOffersByType(e){return this.#a.find((t=>t.type===e)).offers}getOffersTypes(){return this.#a.map((e=>e.type))}getDestinationsNames(){return this.#d.map((e=>e.name))}getDestinationById(e){return this.#d.find((t=>t.id===e))}#y=e=>{const t={...e,basePrice:e.base_price,dateFrom:new Date(e.date_from),dateTo:new Date(e.date_to),isFavorite:e.is_favorite};return delete t.base_price,delete t.date_from,delete t.date_to,delete t.is_favorite,t}};S.init();const x=new class{#b=o.EVERYTHING;get filter(){return this.#b}},I=new class{#g=a.DAY;get sort(){return this.#g}},M=new class{#w=null;#$=null;#C=null;constructor(e,t){this.#C=e,this.#w=t}init(){const i=this.#w.waypoints,s=i.map((e=>this.#w.getDestinationById(e.destination).name)),o=i.map((e=>[e.dateFrom,e.dateTo])),a=i.reduce(((e,t)=>{const n=this.#w.getOffersByType(t.type).filter((e=>t.offers.includes(e.id)));return e+(t.basePrice+n.reduce(((e,t)=>e+t.price),0))}),0),r=this.#$;this.#$=new w(s,o,a),r?(t(this.#$,r),n(r)):e(this.#$,this.#C,"afterbegin")}}(T,S);M.init();const L=new class{#T=null;#E=null;#w=null;#S=null;constructor(e,t,n){this.#T=e,this.#E=t,this.#w=n}get filters(){const e=this.#w.waypoints;return Object.values(o).map((t=>({type:t,count:h[t](e).length})))}init(){const i=this.filters,s=this.#S;this.#S=new $(i,this.#E.filter),s?(t(this.#S,s),n(s)):e(this.#S,this.#T)}}(E,x,S);L.init();const F=new class{#x=null;#I=null;#M=null;constructor(e,t){this.#x=e,this.#I=t}get sortTypes(){return Object.values(a).map((e=>e))}get sortItems(){return Object.values(r).map((e=>e))}init(){const i=this.sortTypes,o=this.sortItems,a=this.#M;this.#M=new s(i,o,this.#I.sort),a?(t(this.#M,a),n(a)):e(this.#M,this.#x)}}(C,I);F.init();const A=new class{#r=null;#L=new y;#F=new v;#A=new g;#w=null;#D=!1;constructor(e,t){this.#r=e,this.#w=t}get waypoints(){return this.#w.waypoints}init(){this.#O()}#U(){e(this.#F,this.#r)}#N(e){const t=this.#w.getDestinationById(e.destination),n=this.#w.getOffersByType(e.type),i=this.#w.getOffersTypes(),s=this.#w.getDestinationsNames();new m(this.#L.element).init(e,t,n,i,s)}#R(e){e.forEach((e=>this.#N(e)))}#P(){e(this.#A,this.#r)}#O(){this.#D?this.#U():0!==this.waypoints.length?(e(this.#L,this.#r),this.#R(this.waypoints)):this.#P()}}(C,S);F.init(),A.init()})();
//# sourceMappingURL=bundle.8d66a8d84b7ed45e5d67.js.map