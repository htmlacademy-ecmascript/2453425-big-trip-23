(()=>{"use strict";var e={10:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(537),s=n.n(i),o=n(645),a=n.n(o)()(s());a.push([e.id,".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n","",{version:3,sources:["webpack://./src/framework/view/abstract-view.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,WAAW;AACb;;AAEA;EACE;;IAEE,wBAAwB;EAC1B;;EAEA;;;;;IAKE,2BAA2B;EAC7B;;EAEA;;;;IAIE,0BAA0B;EAC5B;AACF",sourcesContent:[".shake {\n  animation: shake 0.6s;\n  position: relative;\n  z-index: 10;\n}\n\n@keyframes shake {\n  0%,\n  100% {\n    transform: translateX(0);\n  }\n\n  10%,\n  30%,\n  50%,\n  70%,\n  90% {\n    transform: translateX(-5px);\n  }\n\n  20%,\n  40%,\n  60%,\n  80% {\n    transform: translateX(5px);\n  }\n}\n"],sourceRoot:""}]);const r=a},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,s,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(a[l]=!0)}for(var d=0;d<e.length;d++){var p=[].concat(e[d]);i&&a[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=o),n&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=n):p[2]=n),s&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=s):p[4]="".concat(s)),t.push(p))}},t}},537:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(s," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},379:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},a=[],r=0;r<e.length;r++){var l=e[r],d=i.base?l[0]+i.base:l[0],p=o[d]||0,c="".concat(d," ").concat(p);o[d]=p+1;var h=n(c),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(u);else{var f=s(u,i);i.byIndex=r,t.splice(r,0,{identifier:c,updater:f,references:1})}a.push(c)}return a}function s(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var o=i(e=e||[],s=s||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var r=n(o[a]);t[r].references--}for(var l=i(e,s),d=0;d<o.length;d++){var p=n(o[d]);0===t[p].references&&(t[p].updater(),t.splice(p,1))}o=l}}},569:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{const e="afterbegin";function t(e,t,n="beforeend"){if(!(e instanceof g))throw new Error("Can render only components");if(null===t)throw new Error("Container element doesn't exist");t.insertAdjacentElement(n,e.element)}function i(e,t){if(!(e instanceof g&&t instanceof g))throw new Error("Can replace only components");const n=e.element,i=t.element,s=i.parentElement;if(null===s)throw new Error("Parent element doesn't exist");s.replaceChild(n,i)}function s(e){if(null!==e){if(!(e instanceof g))throw new Error("Can remove only components");e.element.remove(),e.removeElement()}}var o=n(379),a=n.n(o),r=n(795),l=n.n(r),d=n(569),p=n.n(d),c=n(565),h=n.n(c),u=n(216),f=n.n(u),y=n(589),m=n.n(y),v=n(10),_={};_.styleTagTransform=m(),_.setAttributes=h(),_.insert=p().bind(null,"head"),_.domAPI=l(),_.insertStyleElement=f(),a()(v.Z,_),v.Z&&v.Z.locals&&v.Z.locals;const w="shake";class g{#e=null;constructor(){if(new.target===g)throw new Error("Can't instantiate AbstractView, only concrete one.")}get element(){return this.#e||(this.#e=function(e){const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}(this.template)),this.#e}get template(){throw new Error("Abstract method not implemented: get template")}removeElement(){this.#e=null}shake(e){this.element.classList.add(w),setTimeout((()=>{this.element.classList.remove(w),e?.()}),600)}}class C extends g{#t=null;#n=null;#i=null;#s=null;constructor({sortTypes:e,sortItems:t,currentSort:n,onSortChange:i}){super(),this.#t=e,this.#i=t,this.#n=n,this.#s=i,this.element.addEventListener("change",this.#o)}get template(){return e=this.#t,t=this.#i,n=this.#n,`<form class="trip-events__trip-sort  trip-sort" action="#" method="get">\n      ${t.reduce(((t,i)=>`${t} ${((e,t,n)=>`<div class="trip-sort__item  trip-sort__item--${t}">\n    <input\n    id="sort-${t}"\n    class="trip-sort__input visually-hidden"\n    type="radio"\n    name="trip-sort"\n    value="sort-${t}"\n    ${t===n?"checked":""}\n    ${e.includes(t)?"":"disabled"}\n  >\n    <label class="trip-sort__btn" for="sort-${t}">${t}</label>\n  </div>`)(e,i,n)}`),"")}\n    </form>`;var e,t,n}#o=e=>{e.preventDefault();const t=e.target.value.split("-")[1];this.#s(t)}}const b={EVERYTHING:"everything",FUTURE:"future",PRESENT:"present",PAST:"past"},E={DAY:"day",TIME:"time",PRICE:"price"},T={DAY:"day",EVENT:"event",TIME:"time",PRICE:"price",OFFERS:"offers"},S={DAYS:"D",HOURS:"H",MINUTES:"M"},M="PATCH",D="MINOR",$="MAJOR",k="INIT",F="ADD_WAYPOINT",A="DELETE_WAYPOINT",L="UPDATE_WAYPOINT";class x extends g{_state={};updateElement(e){e&&(this._setState(e),this.#a())}_restoreHandlers(){throw new Error("Abstract method not implemented: restoreHandlers")}_setState(e){this._state=structuredClone({...this._state,...e})}#a(){const e=this.element,t=e.parentElement;this.removeElement();const n=this.element;t.replaceChild(n,e),this._restoreHandlers()}}const I={basePrice:0,dateFrom:"",dateTo:"",destination:"",isFavorite:!1,offers:[],type:"flight"};class H extends x{#r=null;#l=null;#d=null;constructor({waypoint:e=I,offers:t,destinations:n,onRollupClick:i,onFormSubmit:s,onFormDeleteClick:o}){super(),this._setState(H.parseWaypointToState(e)),this.waypoint=e,this.offers=t,this.destinations=n,this.#r=i,this.#l=s,this.#d=o,this._restoreHandlers()}get template(){return((e,t,n)=>{const i=t.map((e=>e.type)),s=n.find((t=>t.id===e.destination)),o=n.map((e=>e.name)),a=t.find((t=>t.type===e.type)).offers,r=e.dateFrom.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"2-digit"}).split(",").join(""),l=e.dateTo.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,day:"2-digit",month:"2-digit",year:"2-digit"}).split(",").join("");return`<li class="trip-events__item">\n      <form class="event event--edit" action="#" method="post">\n        <header class="event__header">\n          <div class="event__type-wrapper">\n            <label class="event__type  event__type-btn" for="event-type-toggle-1">\n              <span class="visually-hidden">Choose event type</span>\n              <img\n              class="event__type-icon"\n              width="17"\n              height="17"\n              src="img/icons/${e.type}.png" alt="Event type icon"\n              >\n            </label>\n            <input class="event__type-toggle  visually-hidden" id="event-type-toggle-1" type="checkbox">\n\n            <div class="event__type-list">\n              <fieldset class="event__type-group">\n                <legend class="visually-hidden">Event type</legend>\n\n                ${(e=>e.reduce(((e,t)=>`${e} ${(e=>`<div class="event__type-item">\n    <input id="event-type-${e}-1" class="event__type-input  visually-hidden" type="radio" name="event-type" value="${e}">\n    <label class="event__type-label  event__type-label--${e}" for="event-type-${e}-1">${e}</label>\n  </div>`)(t)}`),""))(i)}\n\n              </fieldset>\n            </div>\n          </div>\n\n          <div class="event__field-group  event__field-group--destination">\n            <label class="event__label  event__type-output" for="event-destination-1">\n              ${e.type}\n            </label>\n            <input\n            class="event__input\n            event__input--destination"\n            id="event-destination-1"\n            type="text"\n            name="event-destination"\n            value="${s?.name||""}" list="destination-list-1"\n            >\n            ${(e=>`<datalist id="destination-list-1">\n    ${(e=>e.reduce(((e,t)=>`${e} <option value="${t}"></option>`),""))(e)}\n  </datalist>`)(o)}\n          </div>\n\n          <div class="event__field-group  event__field-group--time">\n            <label class="visually-hidden" for="event-start-time-1">From</label>\n            <input class="event__input  event__input--time" id="event-start-time-1" type="text" name="event-start-time" value="${r}">\n            &mdash;\n            <label class="visually-hidden" for="event-end-time-1">To</label>\n            <input class="event__input  event__input--time" id="event-end-time-1" type="text" name="event-end-time" value="${l}">\n          </div>\n\n          <div class="event__field-group  event__field-group--price">\n            <label class="event__label" for="event-price-1">\n              <span class="visually-hidden">Price</span>\n              &euro;\n            </label>\n            <input\n            class="event__input\n            event__input--price"\n            id="event-price-1"\n            type="text"\n            name="event-price"\n            value="${e.basePrice}"\n            >\n          </div>\n\n          <button class="event__save-btn  btn  btn--blue" type="submit">Save</button>\n          <button class="event__reset-btn" type="reset">Delete</button>\n          ${(e=>e.id?'<button class="event__rollup-btn" type="button">\n      <span class="visually-hidden">Open event</span>\n    </button>':"")(e)}\n\n        </header>\n        <section class="event__details">\n          ${((e,t)=>{if(!t.length)return"";const n=t.reduce(((t,n)=>t+((e,t)=>{const n=e.offers.includes(t.id)?"checked":"";return`<div class="event__offer-selector">\n      <input class="event__offer-checkbox  visually-hidden" id="${t.id}" type="checkbox" name="${t.id}" ${n}>\n      <label class="event__offer-label" for="${t.id}">\n        <span class="event__offer-title">${t.title}</span>\n        &plus;&euro;&nbsp;\n        <span class="event__offer-price">${t.price}</span>\n      </label>\n    </div>`})(e,n)),"");return`<section class="event__section  event__section--offers">\n      <h3 class="event__section-title  event__section-title--offers">Offers</h3>\n      <div class="event__available-offers">\n        ${n}\n      </div>\n    </section>`})(e,a)}\n\n          ${d=s,d&&(d.pictures.length||d.description)?`<section class="event__section  event__section--destination">\n      <h3 class="event__section-title  event__section-title--destination">Destination</h3>\n      ${c=d.description,c?`<p class="event__destination-description">${c}</p>`:""}\n      ${p=d.pictures,p.length?`<div class="event__photos-container">\n      <div class="event__photos-tape">\n        ${p.reduce(((e,t)=>`${e} ${(e=>`<img class="event__photo" src="${e.src}" alt="${e.description}">`)(t)}`),"")}\n      </div>\n    </div>`:""}\n    </section>`:""}\n        </section>\n      </form>\n    </li>`;var d,p,c})(this._state,this.offers,this.destinations)}reset(e){this.updateElement(H.parseWaypointToState(e))}_restoreHandlers(){this.element.querySelector("form").addEventListener("submit",this.#p),this.element.querySelector(".event__reset-btn").addEventListener("click",this.#c),this.element.querySelector(".event__type-group").addEventListener("change",this.#h),this.element.querySelector(".event__input--destination").addEventListener("change",this.#u),this.element.querySelector(".event--edit").addEventListener("change",this.#f),this.element.querySelector(".event__input--price").addEventListener("input",this.#y),this.element.querySelector("#event-start-time-1").addEventListener("input",this.#m),this.element.querySelector("#event-end-time-1").addEventListener("input",this.#m),this.#r&&this.element.querySelector(".event__rollup-btn").addEventListener("click",this.#v)}#v=e=>{e.preventDefault(),this.#r()};#h=e=>{e.preventDefault(),this.updateElement({type:e.target.value,offers:[]})};#u=e=>{e.preventDefault();const t=e.target.value,n=this.destinations.find((e=>e.name===t)).id;this.updateElement({destination:n})};#f=e=>{if(e.target.classList.contains("event__offer-checkbox")){e.preventDefault();const t=[...this.element.querySelectorAll(".event__offer-checkbox")].filter((e=>e.checked)).map((e=>e.id));this.updateElement({offers:t})}};#y=e=>{e.preventDefault(),this._setState({basePrice:+e.target.value})};#m=e=>{"event-start-time-1"===e.target.id&&this._setState({dateFrom:new Date(e.target.value)}),"event-end-time-1"===e.target.id&&this._setState({dateTo:new Date(e.target.value)})};#p=e=>{e.preventDefault(),this.#l(H.parseStateToWaypoint(this._state))};#c=e=>{e.preventDefault(),this.#d(H.parseStateToWaypoint(this._state))};static parseWaypointToState(e){const t={...e};return t.isSaving=!1,t.isDisabled=!1,t.isDeleting=!1,t}static parseStateToWaypoint(e){const t={...e};return delete t.isSaving,delete t.isDisabled,delete t.isDeleting,t}}const W={[S.DAYS]:e=>Math.floor(e/864e5),[S.HOURS]:e=>Math.floor(e/36e5%24),[S.MINUTES]:e=>Math.floor(e/6e4%60)},R={[b.EVERYTHING]:e=>e.filter((e=>e)),[b.FUTURE]:e=>e.filter((e=>e.dateFrom>new Date)),[b.PRESENT]:e=>e.filter((e=>e.dateFrom<=new Date&&e.dateTo>=new Date)),[b.PAST]:e=>e.filter((e=>e.dateTo<new Date))},P={[E.DAY]:(e,t)=>e.dateFrom-t.dateFrom,[E.TIME]:(e,t)=>{const n=e.dateTo-e.dateFrom;return t.dateTo-t.dateFrom-n},[E.PRICE]:(e,t)=>t.basePrice-e.basePrice};class O extends g{#_=null;#w=null;#g=null;#r=null;#C=null;constructor({waypoint:e,offers:t,destinations:n,onRollupClick:i,onFavoriteClick:s}){super(),this.#_=e,this.#g=n,this.#w=t,this.#r=i,this.#C=s,this.element.querySelector(".event__rollup-btn").addEventListener("click",this.#v),this.element.querySelector(".event__favorite-btn").addEventListener("click",this.#b)}get template(){return((e,t,n)=>{const i=e.dateFrom.toISOString().slice(0,10),s=e.dateFrom.toISOString().slice(0,16),o=e.dateTo.toISOString().slice(0,16),a=e.dateFrom.toISOString().slice(11,16),r=e.dateTo.toISOString().slice(11,16),l=((e,t)=>{const n=t-e,i=Object.values(S).reduce(((e,t)=>{let i=((e,t)=>{let n=W[t](e);return n=n<1?"":n<10?`0${n}${t}`:`${n}${t}`,n})(n,t);return""===e.trim()||i||(i=`00${t}`),`${e} ${i}`}),"");return i})(e.dateFrom,e.dateTo),d=e.isFavorite?"event__favorite-btn--active":"",p=e.basePrice,c=e.type,h=n.find((t=>t.id===e.destination)).name;return`<li class="trip-events__item">\n      <div class="event">\n        <time class="event__date" datetime="${i}">${e.dateFrom.toLocaleString("en-US",{month:"short",day:"numeric"})}</time>\n        <div class="event__type">\n          <img class="event__type-icon" width="42" height="42" src="img/icons/${c}.png" alt="Event type icon">\n        </div>\n        <h3 class="event__title">${c} ${h}</h3>\n        <div class="event__schedule">\n          <p class="event__time">\n            <time class="event__start-time" datetime="${s}">${a}</time>\n            &mdash;\n            <time class="event__end-time" datetime="${o}">${r}</time>\n          </p>\n          <p class="event__duration">${l}</p>\n        </div>\n        <p class="event__price">\n          &euro;&nbsp;<span class="event__price-value">${p}</span>\n        </p>\n        <h4 class="visually-hidden">Offers:</h4>\n        ${(e=>e.length?`<ul class="event__selected-offers">\n      ${e.reduce(((e,t)=>`${e} ${(({title:e,price:t})=>`<li class="event__offer">\n    <span class="event__offer-title">${e}</span>\n      &plus;&euro;&nbsp;\n    <span class="event__offer-price">${t}</span>\n  </li>`)(t)}`),"")}\n    </ul>`:"")(t.find((t=>t.type===e.type)).offers.filter((t=>e.offers.includes(t.id))))}\n        <button class="event__favorite-btn ${d}" type="button">\n          <span class="visually-hidden">Add to favorite</span>\n          <svg class="event__favorite-icon" width="28" height="28" viewBox="0 0 28 28">\n            <path d="M14 21l-8.22899 4.3262 1.57159-9.1631L.685209 9.67376 9.8855 8.33688 14 0l4.1145 8.33688 9.2003 1.33688-6.6574 6.48934 1.5716 9.1631L14 21z"/>\n          </svg>\n        </button>\n        <button class="event__rollup-btn" type="button">\n          <span class="visually-hidden">Open event</span>\n        </button>\n      </div>\n    </li>`})(this.#_,this.#w,this.#g)}#v=e=>{e.preventDefault(),this.#r()};#b=e=>{e.preventDefault(),this.#C()}}const N="DEFAULT",q="EDITING";class B{#E=null;#T=null;#S=null;#_=null;#w=null;#g=null;#M=null;#D=null;#$=N;constructor({waypointListContainer:e,onDataChange:t,onModeChange:n}){this.#E=e,this.#M=t,this.#D=n}init({waypoint:e,offers:n,destinations:o}){this.#_=e,this.#w=n||this.#w,this.#g=o||this.#g;const a=this.#T,r=this.#S;this.#T=new O({waypoint:this.#_,offers:this.#w,destinations:this.#g,onRollupClick:this.#r,onFavoriteClick:this.#C}),this.#S=new H({waypoint:this.#_,offers:this.#w,destinations:this.#g,onRollupClick:this.#r,onFormSubmit:this.#l,onFormDeleteClick:this.#k}),null!==a||null!==r?(this.#$===N&&i(this.#T,a),this.#$===q&&(i(this.#T,r),this.#$=N),s(a),s(r)):t(this.#T,this.#E)}destroy(){s(this.#T),s(this.#S)}setSaving(){this.#$===q&&this.#S.updateElement({isDisabled:!0,isSaving:!0})}setDeleting(){this.#$===q&&this.#S.updateElement({isDisabled:!0,isDeleting:!0})}resetView(){this.#$!==N&&(this.#S.reset(this.#_),this.#F())}#A=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),this.#S.reset(this.#_),this.#F())};#r=()=>{this.#$!==N?(this.#S.reset(this.#_),this.#F()):this.#L()};#C=()=>{this.#M(L,M,{...this.#_,isFavorite:!this.#_.isFavorite})};#l=e=>{this.#M(L,D,e)};#k=e=>{this.#M(A,D,e)};#L(){i(this.#S,this.#T),document.addEventListener("keydown",this.#A),this.#D(),this.#$=q}#F(){i(this.#T,this.#S),document.removeEventListener("keydown",this.#A),this.#$=N}}class U{#E=null;#S=null;#M=null;#x=null;constructor({waypointListContainer:e,onDataChange:t,onDestroy:n}){this.#E=e,this.#M=t,this.#x=n}init({offers:n,destinations:i}){this.#S||(this.#S=new H({offers:n,destinations:i,isNewWaypoint:!0,onFormSubmit:this.#l,onFormDeleteClick:this.#k}),t(this.#S,this.#E.querySelector(".trip-events__list"),e),document.addEventListener("keydown",this.#A))}destroy(){this.#S&&(this.#x(),s(this.#S),this.#S=null,document.removeEventListener("keydown",this.#A))}setSaving(){this.#S.updeteElement({isDisabled:!0,isSaving:!0})}#l=e=>{this.#M(F,D,e)};#k=()=>{this.destroy()};#A=e=>{"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),this.destroy())}}class j extends g{get template(){return'<p class="trip-events__msg">Loading...</p>'}}class Y extends g{get template(){return'<ul class="trip-events__list"></ul>'}}const V={[b.EVERYTHING]:"Click New Event to create your first point",[b.FUTURE]:"There are no future events now",[b.PRESENT]:"There are no present events now",[b.PAST]:"There are no past events now"};class Z extends g{#I=b.EVERYTHING;setFilterType(e){this.#I=e}get template(){return((e="everything")=>`<p class="trip-events__msg">${V[e]}</p>`)(this.#I)}}class G{#H=new Set;addObserver(e){this.#H.add(e)}removeObserver(e){this.#H.delete(e)}_notify(e,t){this.#H.forEach((n=>n(e,t)))}}class K extends g{#W=null;constructor(e){super(),this.#W=e}get template(){return(e=>{const t=e.map((e=>e.destination)),n=e.map((e=>({dateFrom:e.dateFrom,dateTo:e.dateTo}))),i=e.reduce(((e,t)=>e+t.price),0);return`<section class="trip-main__trip-info  trip-info">\n    <div class="trip-info__main">\n      ${(e=>{let t;return t=e.length>3?`${e[0]} &mdash; &hellip; &mdash; ${e[e.length-1]}`:e.join(" &mdash; "),`<h1 class="trip-info__title">${t}</h1>`})(t)}\n\n      ${e.length?(e=>`<p class="trip-info__dates">${e[0].dateFrom.toLocaleString("en-US",{month:"short",day:"numeric"})}&nbsp;&mdash;&nbsp;${e[[e.length-1]].dateTo.toLocaleString("en-US",{month:"short",day:"numeric"})}</p>`)(n):""}\n    </div>\n\n    <p class="trip-info__cost">\n      Total: &euro;&nbsp;<span class="trip-info__cost-value">${i}</span>\n    </p>\n  </section>`})(this.#W)}}class X extends g{#R=null;#P=null;#O=null;constructor({filters:e,currentFilterType:t,onFilterTypeChange:n}){super(),this.#R=e,this.#P=t,this.#O=n,this.element.addEventListener("change",this.#N)}get template(){return((e,t)=>{const n=e.reduce(((e,n)=>`${e} ${((e,t)=>{const{type:n,count:i}=e;return`<div class="trip-filters__filter">\n      <input id="filter-${n}"\n      class="trip-filters__filter-input\n      visually-hidden"\n      type="radio"\n      name="trip-filter"\n      value="${n}"\n      ${n===t?"checked":""}\n      ${0===i?"disabled":""}\n    >\n      <label class="trip-filters__filter-label" for="filter-${n}">${n}</label>\n    </div>`})(n,t)}`),"");return`<form class="trip-filters" action="#" method="get">\n      ${n}\n      <button class="visually-hidden" type="submit">Accept filter</button>\n    </form>`})(this.#R,this.#P)}#N=e=>{e.preventDefault(),this.#O(e.target.value)}}const z=document.querySelector(".trip-events"),J=document.querySelector(".trip-main"),Q=document.querySelector(".trip-controls__filters"),ee=document.querySelector(".trip-main__event-add-btn"),te=new class extends G{#W=[];#w=[];#g=[];get waypoints(){return this.#W}get offers(){return this.#w}get destinations(){return this.#g}getOffersByType(e){return[...this.#w.find((t=>t.type===e)).offers]}getDestinationById(e){return{...this.#g.find((t=>t.id===e))}}init(){this.#w=[{type:"taxi",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_1",title:"Upgrade to a business class",price:120},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_2",title:"aux",price:50}]},{type:"flight",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_flight_1",title:"Add luggage",price:50},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_flight_2",title:"Switch to comfort",price:80}]},{type:"drive",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_drive_1",title:"Rent a car",price:200}]},{type:"check-in",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_check-in_1",title:"Add breakfast",price:50}]},{type:"sightseeing",offers:[{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_1",title:"Book tickets",price:40},{id:"b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_2",title:"Lunch in city",price:30}]}],this.#g=[{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",description:"Chamonix, is a beautiful city, a true asian pearl, with crowded streets.",name:"Chamonix",pictures:[{src:"img/photos/1.jpg",description:"Chamonix parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_2",description:"Amsterdam, is a beautiful city, a true asian pearl, with crowded streets.",name:"Amsterdam",pictures:[{src:"img/photos/2.jpg",description:"Amsterdam parliament building"},{src:"img/photos/3.jpg",description:"Amsterdam parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_3",description:"Geneva, is a beautiful city, a true asian pearl, with crowded streets.",name:"Geneva",pictures:[{src:"img/photos/4.jpg",description:"Geneva parliament building"},{src:"img/photos/5.jpg",description:"Geneva parliament building"}]},{id:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_4",description:"Krasnodar, is a beautiful city, a true asian pearl, with crowded streets.",name:"Krasnodar",pictures:[]}],this.#W=[{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_A",base_price:1100,date_from:"2019-07-10T22:55:56.845Z",date_to:"2019-07-11T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",is_favorite:!1,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_taxi_1"],type:"taxi"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_B",base_price:500,date_from:"2019-07-12T10:55:56.845Z",date_to:"2019-07-12T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_2",is_favorite:!0,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_flight_1","b4c3e4e6-9053-42ce-b747-e281314baa31_flight_2"],type:"flight"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_C",base_price:2400,date_from:"2019-08-15T22:55:56.845Z",date_to:"2019-08-20T11:22:13.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_1",is_favorite:!1,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_drive_1"],type:"drive"},{id:"f4b62099-293f-4c3d-a702-94eec4a2808c_D",base_price:155,date_from:"2019-08-21T08:55:56.845Z",date_to:"2019-08-21T11:00:00.375Z",destination:"cfe416cq-10xa-ye10-8077-2fs9a01edcab_4",is_favorite:!0,offers:["b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_1","b4c3e4e6-9053-42ce-b747-e281314baa31_sightseeing_2"],type:"sightseeing"}].map(this.#q),this._notify(k)}updateWaypoint(e,t){const n=this.#W.findIndex((e=>e.id===t.id));if(-1===n)throw new Error("Can not update unexisting waypoint");this.#W=[...this.#W.slice(0,n),t,...this.#W.slice(n+1)],this._notify(e,t)}addWaypoint(e,t){t.id=+new Date,this.#W=[...this.#W,t],this._notify(e,t)}deleteWaypoint(e,t){const n=this.#W.findIndex((e=>e.id===t.id));if(-1===n)throw new Error("Can not update unexisting waypoint");this.#W=[...this.#W.slice(0,n),...this.#W.slice(n+1)],this._notify(e,t)}#q=e=>{const t={...e,basePrice:e.base_price,dateFrom:new Date(e.date_from),dateTo:new Date(e.date_to),isFavorite:e.is_favorite};return delete t.base_price,delete t.date_from,delete t.date_to,delete t.is_favorite,t}},ne=new class extends G{#B=b.EVERYTHING;get filter(){return this.#B}setFilter(e,t){this.#B=t,this._notify(e,t)}},ie=new class extends G{#U=E.DAY;get sort(){return this.#U}setSort(e,t){this.#U=t,this._notify(e,t)}},se=new class{#j=null;#Y=null;#V=null;constructor({tripInfoContainer:e,waypointsModel:t}){this.#V=e,this.#j=t,this.#j.addObserver(this.#Z)}init(){const n=this.#j.waypoints.sort(P[E.DAY]).map((e=>{const t=this.#j.getDestinationById(e.destination).name,n=this.#j.getOffersByType(e.type).filter((t=>e.offers.includes(t.id))).reduce(((e,t)=>e+t.price),0);return{dateFrom:e.dateFrom,dateTo:e.dateTo,destination:t,price:e.basePrice+n}})),o=this.#Y;this.#Y=new K(n),o?(i(this.#Y,o),s(o)):t(this.#Y,this.#V,e)}#Z=()=>{this.init()}}({tripInfoContainer:J,waypointsModel:te}),oe=new class{#G=null;#K=null;#j=null;#X=null;constructor({filterContainer:e,filterModel:t,waypointsModel:n}){this.#G=e,this.#K=t,this.#j=n,this.#j.addObserver(this.#Z),this.#K.addObserver(this.#Z)}get filters(){const e=this.#j.waypoints;return Object.values(b).map((t=>({type:t,count:R[t](e).length})))}init(){const e=this.#X;this.#X=new X({filters:this.filters,currentFilterType:this.#K.filter,onFilterTypeChange:this.#O}),e?(i(this.#X,e),s(e)):t(this.#X,this.#G)}#Z=()=>{this.init()};#O=e=>{this.#K.filter!==e&&this.#K.setFilter($,e)}}({filterContainer:Q,filterModel:ne,waypointsModel:te}),ae=new class{#z=null;#J=null;#j=null;#Q=null;constructor({sortContainer:e,sortModel:t,waypointsModel:n}){this.#z=e,this.#J=t,this.#j=n,this.#j.addObserver(this.#Z),this.#J.addObserver(this.#Z)}get sortTypes(){return Object.values(E).map((e=>e))}get sortItems(){return Object.values(T).map((e=>e))}init(){const n=this.sortTypes,o=this.sortItems,a=this.#Q;this.#Q=new C({sortTypes:n,sortItems:o,currentSort:this.#J.sort,onSortChange:this.#s}),a?(i(this.#Q,a),s(a)):t(this.#Q,this.#z,e)}#s=e=>{this.#J.sort!==e&&this.#J.setSort(D,e)};#Z=()=>{this.init()}}({sortContainer:z,sortModel:ie,waypointsModel:te}),re=new class{#E=null;#j=null;#K=null;#J=null;#ee=null;#te=new Y;#ne=new j;#ie=new Z;#I=b.EVERYTHING;#se=E.DAY;#oe=new Map;#ae=!0;constructor({waypointListContainer:e,waypointsModel:t,filterModel:n,sortModel:i,onNewWaypointDestroy:s}){this.#E=e,this.#j=t,this.#K=n,this.#J=i,this.#ee=new U({waypointListContainer:this.#E,onDataChange:this.#re,onDestroy:s}),this.#j.addObserver(this.#Z),this.#K.addObserver(this.#Z),this.#J.addObserver(this.#Z)}get waypoints(){this.#I=this.#K.filter,this.#se=this.#J.sort;const e=this.#j.waypoints;return R[this.#I](e).sort(P[this.#se])}init(){this.#le()}createWaypoint(){const e=this.#j.offers,t=this.#j.destinations;this.#K.setFilter($,b.EVERYTHING),this.#J.setSort($,E.DAY),this.#ee.init({offers:e,destinations:t})}#D=()=>{this.#ee.destroy(),this.#oe.forEach((e=>e.resetView()))};#re=(e,t,n)=>{switch(e){case F:this.#j.addWaypoint(t,n);break;case A:this.#j.deleteWaypoint(t,n);break;case L:this.#oe.get(n.id).setSaving(),this.#j.updateWaypoint(t,n)}};#Z=(e,t)=>{switch(e){case M:this.#oe.get(t.id).init({waypoint:t});break;case D:this.#de(),this.#le();break;case $:this.#de({resetSortType:!0}),this.#le();break;case k:this.#ae=!1,s(this.#ne),this.#le()}};#le(){this.#ae?this.#pe():0!==this.waypoints.length?(t(this.#te,this.#E),this.#ce(this.waypoints)):this.#he()}#de({resetSortType:e=!1}={}){e&&this.#J.setSort(D,E.DAY),this.#ee.destroy(),this.#oe.forEach((e=>e.destroy())),this.#oe.clear(),this.#ne&&s(this.#ne),this.#ie&&s(this.#ie)}#pe(){t(this.#ne,this.#E)}#he(){this.#ie.setFilterType(this.#I),t(this.#ie,this.#E)}#ce(e){e.forEach((e=>this.#ue(e)))}#ue(e){const t=this.#j.offers,n=this.#j.destinations,i=new B({waypointListContainer:this.#te.element,onDataChange:this.#re,onModeChange:this.#D});i.init({waypoint:e,offers:t,destinations:n}),this.#oe.set(e.id,i)}}({waypointListContainer:z,waypointsModel:te,filterModel:ne,sortModel:ie,onNewWaypointDestroy:()=>{ee.disabled=!1}});re.init(),oe.init(),ae.init(),se.init(),te.init(),ee.addEventListener("click",(e=>{e.preventDefault(),re.createWaypoint(),ee.disabled=!0}))})()})();
//# sourceMappingURL=bundle.39d095d7085febc3f75f.js.map